<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Frequency data ·  </title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="  logo"/></a><div class="docs-package-name"><span class="docs-autofit"> </span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../architecture/">Architecture</a></li><li><a class="tocitem" href="../fileIO/">File I/O</a></li><li><a class="tocitem" href="../preprocessing/">Preprocessing</a></li><li><a class="tocitem" href="../generatingdata/">Generating Data</a></li><li><span class="tocitem">Fit and Predict</span><ul><li><a class="tocitem" href="../fitpredictTime/">Time data</a></li><li class="is-active"><a class="tocitem" href>Frequency data</a><ul class="internal"><li><a class="tocitem" href="#Fitting-1"><span>Fitting</span></a></li><li><a class="tocitem" href="#Predicting-1"><span>Predicting</span></a></li></ul></li></ul></li><li><span class="tocitem">Models</span><ul><li><a class="tocitem" href="../elements/">Basic Elements</a></li><li><a class="tocitem" href="../fractionalMaxwell/">Maxwell</a></li><li><a class="tocitem" href="../fractionalKelvinVoigt/">Kelvin-Voigt</a></li><li><a class="tocitem" href="../fractionalZener/">Zener</a></li><li><a class="tocitem" href="../fractionalPT/">Poynting-Thomson</a></li><li><a class="tocitem" href="../burgers/">Burgers</a></li><li><a class="tocitem" href="../createmodel/">Create Your Model</a></li></ul></li><li><a class="tocitem" href="../examples/">Examples</a></li><li><a class="tocitem" href="../API/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Fit and Predict</a></li><li class="is-active"><a href>Frequency data</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Frequency data</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaRheology/RHEOS.jl/blob/master/docs/src-staging/fitpredictFreq.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Fitting-and-Predicting-Frequency-data-1"><a class="docs-heading-anchor" href="#Fitting-and-Predicting-Frequency-data-1">Fitting and Predicting - Frequency data</a><a class="docs-heading-anchor-permalink" href="#Fitting-and-Predicting-Frequency-data-1" title="Permalink"></a></h1><p>RHEOS can also fit models to dynamic mechanical analysis data from oscillatory tests</p><pre class="language-julia"><code class="language-julia">using RHEOS</code></pre><h2 id="Fitting-1"><a class="docs-heading-anchor" href="#Fitting-1">Fitting</a><a class="docs-heading-anchor-permalink" href="#Fitting-1" title="Permalink"></a></h2><p><strong>Step 1: Loading of the experimental data</strong></p><p>RHEOS has a convenient function to import data from CSV files (more information in <a href="../fileIO/#File-I/O-1">File I/O</a> section).</p><pre class="language-julia"><code class="language-julia">data = importcsv(&quot;data_freq.csv&quot;, ω_col=1, Gp_col=2, Gpp_col=3);
RheoFreqDataType(data)</code></pre><pre class="language-output"><code class="language-output">┌ Warning: Please note that NaN data rows are not included in resultant data struct.
└ @ RHEOS /home/alessandra/.julia/dev/RHEOS/src/IO.jl:11</code></pre><pre class="language-output"><code class="language-output">with_modulus::FreqDataType = 1</code></pre><p>The frequency, storage modulus and loss modulus are stored into a <a href="../API/#RHEOS.RheoFreqData"><code>RheoFreqData</code></a> struct. </p><p><strong>Step 2: Model fit</strong></p><p>Let&#39;s fit a Fractional Kelvin-Voigt model. The first argument is our data, the second argument tells RHEOS which model to fit (<a href="../API/#RHEOS.RheoModelClass"><code>RheoModelClass</code></a>). The function will return a <a href="../API/#RHEOS.RheoModel"><code>RheoModel</code></a> object, i.e. a <a href="../API/#RHEOS.RheoModelClass"><code>RheoModelClass</code></a> with fixed values for the parameters. The function <a href="../API/#RHEOS.dynamicmodelfit"><code>dynamicmodelfit</code></a> possesses all the additional arguments (lower and upper bounds, initial parameters, tolerance) as for the fitting of time data. Note that initial parameters, upper bounds and lower bounds can be partially specified and the rest will be filled in automatically.</p><pre class="language-julia"><code class="language-julia"># Lower bounds
Lo = (cₐ=0.0, a=0.01, cᵦ=0.0, β = 0.01)
# Upper bounds
Hi = (cₐ=1e2, a=0.99, cᵦ=1e2, β = 0.99)
# Initial parameters
P0 = (cₐ=1.0, a=0.36, cᵦ=1.0, β = 0.03)

FractKV_model = dynamicmodelfit(data, Fract_KelvinVoigt, weights = &quot;log&quot;, lo = Lo, hi = Hi, p0 = P0)</code></pre><pre class="language-output"><code class="language-output">┌ Warning: Note that a logarithmic rescaling will fail if Gp or Gpp data contain 0.0 values as it will result in -Inf cost. Trying a different rescaling scheme, or not fitting around ω≈0.0 may alleviate the issue.
└ @ RHEOS /home/alessandra/.julia/dev/RHEOS/src/processing.jl:714</code></pre><pre class="language-output"><code class="language-output">Time: 0.385953893 s, Why: XTOL_REACHED, Parameters: [0.00921903, 0.770062, 0.913296, 0.100392], Error: 0.34215629087463373</code></pre><pre class="language-output"><code class="language-output">Model: fractKV

Parameter values: (cₐ = 0.009219028112809006, a = 0.7700618789054214, cᵦ = 0.9132958174053891, β = 0.10039200856098299) 

                ________ ╱╲ ________
               |         ╲╱  cₐ, a  |
           ____|                    |____
               |                    |
               |________ ╱╲ ________|
                         ╲╱  cᵦ, β</code></pre><p>For the fitting process RHEOS relies on the optimistion package <a href="https://nlopt.readthedocs.io/en/latest/">NLopt.jl</a>. RHEOS makes use of a local derivative free algorithm; specifically, Tom Rowan&#39;s &quot;Subplex&quot; algorithm originally introduced in </p><ul><li>T. Rowan, &quot;Functional Stability Analysis of Numerical Algorithms&quot;, Ph.D. thesis, Department of Computer Sciences, University of Texas at Austin, 1990.</li></ul><p>The storage and loss moduli can sometimes occupy different orders of magnitude. This can cause problems during fitting as the optimisation routine will weight errors at the higher orders of magnitude more strongly than those at the lower orders of magnitude. This is a more general problem often faced during multi-objective optimisation problems. RHEOS offers four rescaling options (weight):</p><ul><li>The <code>local</code> option rescales the cost at each point by the point itself. </li><li>The <code>log</code> approach simply re-scales all the storage and loss moduli and their predicted values logarithmically before finding the error between them. </li><li>A third option in RHEOS divides the cost at each point by the mean value of the storage and loss modulus respectively depending on which cost is being calculated. This can work well but performance is hindered if the storage or loss moduli individually vary over many orders of magnitude (<code>mean</code>). </li><li>The fourth option offered by RHEOS is simply manual weightings provided by the user for each modulus (<code>manual</code>). </li></ul><p>In the first two cases, the benefit arises from the fact that the optimisation weighting is rebalanced in favour of smaller values. The logarithmic rescaling method seems to work particularly well but runs into problems if the storage or loss moduli are exactly 0 at any frequency, this is due to the negative singularity of the logarithmic function for the 0 argument. 0 arguments can also cause problems using the <code>local</code> option due to division by 0.</p><h2 id="Predicting-1"><a class="docs-heading-anchor" href="#Predicting-1">Predicting</a><a class="docs-heading-anchor-permalink" href="#Predicting-1" title="Permalink"></a></h2><p>RHEOS allows the user to simulate the frequency response of a model (with defined parameters, <a href="../API/#RHEOS.RheoModel"><code>RheoModel</code></a> struct) to an imposed loading. </p><p>Given an incomplete data set (frequency only) and model with values substituted into parameters (<a href="../API/#RHEOS.RheoModel"><code>RheoModel</code></a>), return a new &quot;complete&quot; dataset based on the model with the simulated missing variable (storage and loss).</p><p><strong>Assess quality of the fit</strong></p><p>The ability of predicting model&#39;s response is first exploited to assess the quality of the fits above. The incomplete <a href="../API/#RHEOS.RheoFreqData"><code>RheoFreqData</code></a> variable is defined by extracting the frequency from the original data or by defining a new frequency vector.</p><pre class="language-julia"><code class="language-julia">data_ext = extract(data,freq_only);
# Alternatively, a RheoFreqData with only frequency data can be generated as
# data_gen = frequencyspec(ω_start=1.0e-2, ω_end=1.0e2, step=1.0e-5)

RheoFreqDataType(data_ext)</code></pre><pre class="language-output"><code class="language-output">freq_only::FreqDataType = 0</code></pre><p>For the prediction, RHEOS&#39; function <a href="../API/#RHEOS.dynamicmodelpredict"><code>dynamicmodelpredict</code></a> requires the incomplete data set and a model with fixed parameters (<a href="../API/#RHEOS.RheoModel"><code>RheoModel</code></a>). For the assessment of the fitting quality the <a href="../API/#RHEOS.RheoModel"><code>RheoModel</code></a> is the output of the fitting function. </p><pre class="language-julia"><code class="language-julia">fractKV_predict = dynamicmodelpredict(data_ext, FractKV_model)

# Now we can plot data and model together for comparison
using PyPlot
loglog(data.ω, data.Gp, &quot;o&quot;, markersize = 5, color=&quot;blue&quot;);
loglog(data.ω, data.Gpp, &quot;o&quot;, markersize = 5, color = &quot;red&quot;);
loglog(fractKV_predict.ω, fractKV_predict.Gp, &quot;--&quot;, color=&quot;blue&quot;);
loglog(fractKV_predict.ω, fractKV_predict.Gpp, &quot;--&quot;, color=&quot;red&quot;);
xlabel(&quot;Frequency&quot;);
ylabel(&quot;Storage and Loss moduli&quot;);</code></pre><p><img src="../fitpredictFreq_files/fitpredictFreq_17_0.png" alt="png"/></p><p><strong>Simulate different model behaviours</strong></p><p>The ability of predicting model&#39;s response can be exploited to simulate the behaviour of the model to other external loading conditions. For example, we will explore the response of the fitted model to a creep experiment. </p><p>First we need to define an incomplete <a href="../API/#RHEOS.RheoTimeData"><code>RheoTimeData</code></a> struct, which can be achieved via the data generation functions provided in RHEOS (see section <a href="../generatingdata/#Generating-Data-1">Generating Data</a>).</p><pre class="language-julia"><code class="language-julia"># Define timeline
dσ = timeline()
# and a step in stress
dσ = stressfunction(dσ,hstep())

# we can now predict the creep response of the Maxwell model 
FractKV_creepPredict = modelsteppredict(dσ,FractKV_model)
# Visualisation of the simulated response
plot(FractKV_creepPredict.t,FractKV_creepPredict.ϵ);
xlabel(&quot;Time&quot;);
ylabel(&quot;Strain&quot;);</code></pre><p><img src="../fitpredictFreq_files/fitpredictFreq_20_0.png" alt="png"/></p><p><strong>Reference frequency data</strong>: Deng, Linhong, et al. &quot;Fast and slow dynamics of the cytoskeleton.&quot; Nature materials 5.8 (2006): 636.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../fitpredictTime/">« Time data</a><a class="docs-footer-nextpage" href="../elements/">Basic Elements »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 2 September 2020 17:43">Wednesday 2 September 2020</span>. Using Julia version 1.5.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
